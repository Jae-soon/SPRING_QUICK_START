26 데이터 변환
=======================
시스템이 복잡해지면서 다른 시스템과 정보를 주고받을 일이 발생하는데, 이때 데이터 교환 포맷으로 JSON을 사용할 수 있다.    
검색한 글 목록을 JSON 형식의 데이터로 변환하여 브라우저에 출력해보자  
# 1. JSON으로 변환하기  
지금까지 BOARD 테이블에 저장된 게시글 정보를 저장하기 위해서 BoardVO 객체를 사용했다.  
BoardVO 객체에 저장된 데이터를 JSON 데이터로 변환하면 BoardVO 객체가 가진 각 변수와 변수에 저장된 값이 ```'키:값'```형태로 표현된다.    
```
{
  "seq":1,
  "title":"가입인사",
  "writer":"관리자",
  "content":"잘 부탁드립니다.",
  "regDate":"2016-03-19",
  "cnt":0 
}
```
그런데 검색 결과가 하나가 아닌 여러 개 일때는 다음과 같이 배열로 처리된다.  
```
{
  {"seq":1, "title":"가입인사", "writer":"관리자", "content":"잘 부탁드립니다.", "regDate":"2016-03-19", "cnt":0 }
  {"seq":2, "title":"가입인사", "writer":"관리자2", "content":"잘 부탁드립니다.", "regDate":"2016-03-19", "cnt":0 }
}
```
## 1.1. jackson2 라이브러리 내려받기
검색 결과를 JSON 데이터로 변환하려면 가장 먼저 jackson2 라이브러리를 내려받아야 한다.    
BoardWeb 프로젝트의 pom.xml 파일을 열어서 jackson2 라이브러리를 내려받을 수 있도록 ```<dependency>```를 추가한다.    
    
**pom.xml**
```
~ 생략 ~
<dependencies>
	<!-- FileUpload -->
	<dependency>
  		<groupId>commons-fileupload</groupId>
  		<artifactId>commons-fileupload</artifactId>
  		<version>1.3.1</version>
	</dependency>

	<!-- Jackson2 -->
	<dependency>
  		<groupId>com.fasterxml.jackson.core</groupId>
  		<artifactId>jackson-databind</artifactId>
  		<version>2.7.2</version>
	</dependency>
</dependencies>
~ 생략 ~
```
수정된 pom.xml 파일을 저장하고 다음과 같이 jackson2 라이브러리들이 MavenDependencies에 추가되었는지 확인한다.  
pom.xml 파일에 추가한 것은 jackson-databind 파일에 대한 설정이지만,  
jackson-annotations.jar 와 jackson-core.jar 파일도 함께 추가돼있어야 한다.  
   
## 1.2. HttpMessageConvertor
일반적으로 브라우저에서 서블릿이나 JSP 파일을 요청하면, 서버는 클라이언트가 요청한 서블릿이나 JSP를 찾아서 실행한다.  
그리고 실행 결과를 그림 7-2처럼 Http 응답 프로토콜 메시지 바디에 저장하여 브라우저에 전송한다.  
그래서 브라우저는 항상 실행 결과 화면만 표시했던 것이다.    
   
그런데 이 응답 결과를 HTML이 아닌 JSON이나 XML로 변환하여 메시지를 바디에 저장하려면  
스프링에서 제공하는 변환기를 사용해야 한다.    
스프링은 HttpMessageConverter를 구현한 다양한 변환기를 제공하는데,    
이 변환기를 이용하면 자바 객체를 다양한 타입으로 변환하여 HTTP 응답 바디에 설정할 수 있다.    
  
HttpMessageConverter를 구현한 클래스는 여러 가지가 있으며,  
이중에서 자바 객체를 JSON 응답 바디로 변환할 때는 MappingJackson2HttpMessageConverter를 사용한다.  
따라서 MappingJackson2HttpMessageConverter를  스프링 설정 파일에 등록하면 되는데,   
우리는 이후에 XML 변환도 처리할 예정이므로 다음처럼 ```<mvc:annotation-driven>```을 설정한다.    
   
**presentation-layer.xml**
```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.2.xsd">

	<context:component-scan base-package="com.springbook.view"></context:component-scan>
	<mvc:annotation-driven></mvc:annotation-driven>  
      
	<!-- 파일 업로드 설정 -->
	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<property name="maxUploadSize" value="100000"/>
	</bean>
	<mvc:annotation-driven></mvc:annotation-driven>
	
	<!-- 예외 처리 설정 -->
	<bean id="exceptionResovler" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property name="exceptionMappings">
			<props>
				<prop key="java.lang.ArithmeticException">
					common/arithmeticError.jsp
				</prop>
				<prop key="java.lang.NullPointerException">
					common/nullPointerError.jsp
				</prop>
			</props>
		</property>
		<property name="defaultErrorView" value="common/error.jsp"></property>
	</bean>
	
    <!-- 다국어 설정 -->
	<!-- MessageSource 등록 -->
	<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>message.messageSource</value>
			</list>
		</property>
	</bean>
	<!-- LocaleResolver 등록 -->
	<bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver"></bean>
	<!-- LocaleChangeInterceptor 등록 -->
	<mvc:interceptors>
		<bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
			<property name="paramName" value="lang" />
		</bean>
	</mvc:interceptors>
</beans>
```
스프링 설정 파일에 ```<mvc:annotation-driven></mvc:annotation-driven>```을 설정하면  
HttpMessageConverter를 구현한 모든 변환기가 생성된다.    
따라서 이후에 XML 변환에 필요한 변환기도 자동으로 등록된다.    
   
